<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>Welcome to...</title>
    <link rel="stylesheet" href="origin.css">
    <style>
      @font-face {font-family: hangyaku;src: url(clicker-of-mugen/assets/fonts/Hangyaku.ttf);}
      @font-face {font-family: comicsans;src: url(clicker-of-mugen/assets/fonts/comicsans.ttf);}
      @font-face {font-family: papyrus;src: url(clicker-of-mugen/assets/fonts/papyrus.ttf);}
      @font-face {font-family: pricedown;src: url(clicker-of-mugen/assets/fonts/pricedown.ttf);}
      @font-face {font-family: cube12;src: url(clicker-of-mugen/assets/fonts/cube12.ttf);}
      body{
        background-color: #f6fff2;
        overflow: hidden;
      }
      #main{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #title{
        margin: 0 auto;
        font-size: 30px;
        font-family: hangyaku;
        text-decoration: underline dotted;
        text-decoration-color: #b6e3a5;
      }
      #links{
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: #eeffe7;
      }
      #links a{
        margin-top: -2px;
        padding: 5px 15px;
        border: 2px solid #ddffd0;
        text-decoration: none;
        font-size: 20px;
        color: #0f3300;
        font-family: cube12;
      }

      #right{
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        width: 35%;
        height: 100%;
        padding: 10px;
        background: #f0f8ff;
        border-left: 5px solid #cfe9ff;
        position: fixed;
        right: -35%;
        top: 0;
        transition: right 0.5s ease;
        box-sizing: border-box;
      }
      #right.open{
        right: 0;
      }
      #right .toggle{
        width: calc(10% - 2px);
        height: 100%;
        background: #cfe9ff;
        position: absolute;
        left: calc(-10% + 2px);
        top: 0;
      }
      #right .frnin{
        width: 80px;
        height: 80px;
        background: #ddffd0;
        border-radius: 50%;
        position: absolute;
        right: 10px;
        bottom: 10px;
        cursor: pointer;
      }
      #right .frnin img{
        display: block;
        width: 60%;
        height: 60%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        object-fit: contain;
      }
      .fruit {
        position: fixed; /* これ必須 */
        width: 50px;
        height: 50px;
        background: url('clicker-of-mugen/assets/foods/apple.png') no-repeat center/cover;
        pointer-events: none;
      }
      #frninScore {
        display: none;
        position: fixed;
        top: 10px;
        left: 10px;
        font-size: 24px;
        font-family: cube12;
        color: #007ea1;
        text-shadow: 1.5px 1.5px 3px #000;
      }

      #trail {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* キャンバスがマウスイベントを妨げないようにする */
        z-index: 1000; /* 必要に応じて調整 */
      }
    </style>
  </head>
<body>

  <div id="movableDescription"></div>
  <div id="log" style="display: none;">
    <div class="opener"><</div>
    <div class="log"></div>
  </div>
  <div id="text"></div>


  <div id="main">
    <div id="title">My Game-Park!!</div>
    <div id="links">
      <a href="readme.txt">read.me</a>
      <a href="farm-game/index.html">farm game</a>
      <a href="clicker-of-mugen/">clicker of mugen</a>
      <a href="clicker-of-mugen-dungeon/">clicker of mugen dungeons</a>
      <a href="rogue-cardgame/">rogue cardgame</a>
      <a href="witches-journey/">the witches' journey</a>
      <a href="jung-keng/">jung keng online</a>
      <a href="tetris.html">tetris(not a song)</a>
      <a href="probability/">probability-gate-game</a>
    </div>
  </div>

  <div id="right">
    <div class="toggle"></div>
    <a href="https://koppepan-orange.github.io/test-site/">test-site</a>
    <a href="https://koppepan-orange.github.io/france_bread/">france</a>
    <div class="frnin"><img src="clicker-of-mugen/assets/buffs/power.png"></div>
  </div>

  <div id="frninScore"></div>
  <canvas id="trail"></canvas>
  
  
  <script src="origin.js" defer></script>
  <script defer>
    let rightD = document.getElementById('right');
    let rightC = {
      togD: rightD.querySelector('.toggle'),
      opened: false
    }
    rightC.togD.addEventListener('click', () => {
      rightD.classList.toggle('open');
      rightC.opened = !rightC.opened;
    });

    //#region fruit ninja
    // let frninD = document.getElementById('frnin');
    let frninC = {
      startD: rightD.querySelector('.frnin'),
      scoreD: document.getElementById('frninScore'),
      playing: 0,
      looped: 0,
      fruits: [],
      score: 0
    }
    let frninF = {};
    frninF.start = function(){
      if (frninC.playing) return;
      frninC.startD.querySelector('img').src = 'clicker-of-mugen/assets/buffs/palsy.png';
      frninC.startD.style.background = '#ff7d7d';
      frninC.playing = 1;
      frninC.startD.removeEventListener('click', frninF.start);
      frninC.startD.addEventListener('click', frninF.end);

      frninC.looped = 0;
      frninC.fruits = [];
      frninC.score = 0;
      frninC.scoreD.style.display = 'block';
      frninC.scoreD.textContent = `Score: 00000`;
      frninF.gameloop();
    }
    frninF.end = function(){
      frninC.playing = 0;
      frninC.startD.querySelector('img').src = 'clicker-of-mugen/assets/buffs/power.png';
      frninC.startD.style.background = '#ddffd0';
      frninC.startD.removeEventListener('click', frninF.end);
      frninC.startD.addEventListener('click', frninF.start);

      setTimeout(() => {
        frninC.scoreD.style.display = 'none';
      }, 3000);
    }
    frninC.startD.addEventListener('click', frninF.start);

    frninC.scoreTx = [
      {
        num:100,
        texts: [
          '初斬り！',
          'まさに初狩りってね！！',
          '\\\\ﾂｸﾃｰﾝ//'
        ]
      },
      {
        num:2300,
        texts: [
          '23！', 
          'no name社長！23ですぞ！！',
          '効果は特にないそうです！'
        ]
      },
      {
        num:23000,
        texts: [
          'お、君もしや',
          '23があったから230もあるやろ〜',
          'とでも思ったのかい？',
          '正解だよ',
          'ありがとねぇ、こんな終わってるゲームをめっちゃやってくれて',
          '裏話していいかい？',
          '長くなるけど',
          'このゲーム実は補完AIの暴走からできたんですよ',
          '補完AIが勝手にfruitNinja由来か果物を出すやつを作り出して',
          'それを改良する形でこうなりました',
          'すごいよね、なんつーかほぼシンギュラリティよね',
          'え違うって？',
          'まあとにかく聞いてくれてありがとね',
          'これ以上はないとだけ言っておこう'
        ]
      },
      {
        num:99999,
        texts: [
          'さては君、暇だね？',
          'さながらフラウィーを思い出してしまうね',
          'もう何もないから寝るといいよ',
          'tx!'
        ]
      }
    ]
    frninF.score = function(num){
      frninC.score += num;

      if(frninC.score > 99900) frninC.score = 99999;

      if(frninC.score % 3 == 0 || frninC.score.toString().includes('3')) nicoText('ｻｧﾝ');
      let item = frninC.scoreTx.find(a => a.num == frninC.score);
      if(item) for(let t of item.texts){addtext(t)};
    }

    frninC.Fruits = [
      {
        name:'apple',
        size: '150px',
        life: 2,
      },
      {
        name:'orange',
        size: '80px',
        life: 1
      },
      {
        name:'lemon',
        size: '110px',
        life: 1
      },
      {
        name:'kabosu',
        size: '110px',
        life: 2
      }
    ]
    frninF.throw = function(){
      let div = document.createElement('div');
      div.className = 'fruit';
      div.style.right = '-100px';
      div.style.bottom = '-250px';

      let f = arraySelect(frninC.Fruits); //配列の中からランダムに選ぶ関数。
      div.style.background = `url('clicker-of-mugen/assets/foods/${f.name}.png') no-repeat center/cover`;
      div.style.width = f.size;
      div.style.height = f.size;
      

      let obj = {
        x: -100,
        y: -250,
        vx: random(5,10),
        vy: random(30,45),
        g: -0.98,
        life: f.life,
      }

      obj.div = div;
      frninC.fruits.push(obj);

      document.body.appendChild(div);
    }
    frninF.throwing = function(){
      let iran = -1;
      let pro = [100, 25, 10]
      
      for(let p of pro){
        if(!probability(p)) break;
        frninF.throw();
        iran += 1;
      }
      if(iran != pro.length - 1) return;

      //すごい確率！
      let pro2 = pro.map(a => a/100);
      let k = arrayMult(pro2);
      nicoText(`☆ミミ  ${k*100}%の確率を引きました！すごい！！  ☆ミミ`)
    }

    frninF.update = function(){
      for(let i = 0; i < frninC.fruits.length; i++) {
        let f = frninC.fruits[i];
        
        f.x += f.vx;
        f.y += f.vy;
        f.vy += f.g; // 重力で落下

        window.addEventListener('mousemove', (e) => {
          if (!downing) return;
          for (let i = 0; i < frninC.fruits.length; i++) {
            let f = frninC.fruits[i];
            let rect = f.div.getBoundingClientRect();
            if(e.clientX >= rect.left && e.clientX <= rect.right &&
                e.clientY >= rect.top  && e.clientY <= rect.bottom) {
              f.life -= 1;
              if (f.life <= 0) {
                frninF.score(100);
                f.div.remove();
                frninC.fruits.splice(i, 1);
                i--;
              }
            }
          }
        });


        f.div.style.right = `${f.x}px`;
        f.div.style.bottom = `${f.y}px`;

        // 画面外に落ちたら消す
        if(f.y < -300) {
          f.div.remove();
          frninC.fruits.splice(i,1);
          i -= 1;
        }
      }

      frninC.scoreD.textContent = `Score: ${frninC.score.toString().padStart(5, '0')}`;

    };
    

    frninF.gameloop = function(){
      frninC.looped += 1;

      if(!frninC.playing && frninC.fruits.length == 0) return;
      frninF.update();

      if(frninC.playing && frninC.looped == 30) frninF.throwing(), frninC.looped = 0;

      requestAnimationFrame(frninF.gameloop);
    };

    //#endregion

    // マウス軌跡エフェクト
    let downing = false;
    window.addEventListener('mousedown', () => downing = true);
    window.addEventListener('mouseup', () => downing = false);
    window.addEventListener('touchstart', () => downing = true);
    window.addEventListener('touchend', () => downing = false);

    const cvs = document.getElementById('trail');
    const ctx = cvs.getContext('2d');

    function resizeCanvas(){
      cvs.width = window.innerWidth;
      cvs.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    let lastX = null, lastY = null;

    window.addEventListener('pointermove', (e) => {
      if(!frninC.playing) return lastX = null;
      
      if(!downing) return lastX = null;

      if(lastX != null){
        ctx.strokeStyle = '#bebebecc'; // 白っぽい軌跡
        ctx.lineWidth = 8;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.clientX, e.clientY);
        ctx.stroke();
      }
      lastX = e.clientX;
      lastY = e.clientY;
    });

    // 軌跡をゆっくり消す
    function fade(){
      ctx.globalCompositeOperation = 'destination-out';
      ctx.fillStyle = '#0000001a'; 
      ctx.fillRect(0, 0, cvs.width, cvs.height);
      ctx.globalCompositeOperation = 'source-over'; // 通常描画に戻す
      requestAnimationFrame(fade);
    }
    fade();

  </script>
  
</body>
</html>
